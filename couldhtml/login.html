<!-- <!DOCTYPE html>
<html>
  <head>
    <title>Login page</title>
    <style>
      .button-row {
        display: flex;
        justify-content: space-between;
      }

      button {
        flex: 1;
        margin: 0 5px;
      }
    </style>
  </head>
  <body>
    <h1>DJI Cloud API test</h1>

    <div class="button-row">
      <button id="login-button">Login</button>
      <button id="logout-button">Logout</button>
      <button id="raport-button">Raport</button>
    </div>
    <ul id="logs"></ul>
    <script>
      const APP_ID = 130943;
      const LICENSE =
        "HdMDWuYVpt05j3pIk+/vqoJlfY+SP6vp7z6XDyzGeM0d+Oy4JavUyYP/VsOw5i0UE07Lt5q9rzk9Jex1+CnPQO7OzBE6XwcNwZ0pDP/LPTjqdSPRezbmRB8z5yNf5QbEhe1YyLh++JzW9mr9BCkXy1v1h2+Uo0S1MSRZcLgLRw0=";
      const APP_KEY = "36de02838593125bbe9ab32d08813fb";
      var fieldList = document.getElementById("logs");
      var log = function (msg) {
        var li = document.createElement("li");
        li.innerText = msg;
        fieldList.appendChild(li);
      };
      var reg_calback = function () {
        log("Callback calledüéâ, arguments:" + Array.from(arguments));
      };
      var loginButton = document.getElementById("login-button");
      loginButton.addEventListener("click", function () {
        log("login");
        var token = window.djiBridge.platformVerifyLicense(
          APP_ID,
          APP_KEY,
          LICENSE
        );
        log("platform is verified: " + window.djiBridge.platformIsVerified());

        var register_params = JSON.stringify({
          host: "tcp://hostnamehere:1883", // mqtt address, example: tcp://xx.xx.xx.xx:xxx
          connectCallback: "reg_calback", // js interface for connection status callbacks
          username: "userloginhere",
          password: "userpasswordhere",
        });
        log(
          "Load Component: thing " +
            window.djiBridge.platformLoadComponent("thing", register_params) +
            "\n State‚ÑπÔ∏è: " +
            window.djiBridge.thingGetConnectState()
        );
        log(
          "Start the connection thingconn: " +
            window.djiBridge.thingConnect("userloginhere", "userpasswordhere", "reg_calback")
        );

        log("Thing Connect state: " + window.djiBridge.thingGetConnectState());
        // log("TODO here I am supposed to ask about login, password, gateway");
      });

      var logoutButton = document.getElementById("logout-button");
      logoutButton.addEventListener("click", function () {
        log(
          "unregistering: " + window.djiBridge.platformUnloadComponent("thing")
        );
      });

      document
        .getElementById("raport-button")
        .addEventListener("click", function () {
          log(
            "Statusy platformIsComponentLoaded: " +
              window.djiBridge.platformIsComponentLoaded("thing") +
              "\nthing state" +
              window.djiBridge.thingGetConnectState()
          );
        });

      log("platform is verified: " + window.djiBridge.platformIsVerified());
    </script>
  </body>
</html> -->


<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>DJI Cloud API Test</title>
  <style>
    .button-row { display: flex; justify-content: space-between; margin-bottom:1em; }
    button { flex:1; margin:0 5px; }
    #logs { list-style:none; padding:0; font-family:monospace; }
  </style>
</head>
<body>
  <h1>DJI Cloud API Test</h1>
  <div class="button-row">
    <button id="login-button">Login</button>
    <button id="logout-button">Logout</button>
    <button id="report-button">Report</button>
  </div>
  <ul id="logs"></ul>

  <script>
    // „Çµ„Éº„Éê„ÉºËµ∑ÂãïÊôÇ„Å´ÁΩÆÊèõ„Åï„Çå„Çã„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ
    const HOST = "hostnamehere";      // ‰æã: 192.168.0.10
    const USER = "userloginhere";     // ‰æã: admin
    const PASS = "userpasswordhere";  // ‰æã: public

    // DJI Developer „Éù„Éº„Çø„É´„ÅßÂèñÂæó„Åó„ÅüÂÄ§„Å´ÁΩÆ„ÅçÊèõ„Åà„Çã
    const APP_ID  = 168252;
    const APP_KEY = "90014c64b96a1822b28c27a57401e7c";
    const LICENSE = "pPtR5O/12yKso2H8oOOqwsDd9pV4f/MpJKjScqLDk5chRbRaX2LRwallcoWlFWKiCbIEVMw1HuE+KysY66BJMt+Bogw6Ys8aPE6rkSn47oMlYpsEBUm3g6nvMcopyQpo7Aqzqg4rEvUGvQnKTAhA9S55lK6HizhbF/t16x9YzcY=";

    const logs = document.getElementById("logs");
    function log(msg) {
      const li = document.createElement("li");
      li.textContent = msg;
      logs.appendChild(li);
    }

    async function fetchToken() {
      const res = await fetch(`http://${HOST}:5000/auth/token`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username: USER, password: PASS })
      });
      if (!res.ok) throw new Error("Token fetch failed: " + res.status);
      return (await res.json()).access_token;
    }

    document.getElementById("login-button").addEventListener("click", async () => {
      try {
        log("LoginÈñãÂßã");
        const token = await fetchToken();
        log("ÂèñÂæó„Éà„Éº„ÇØ„É≥: " + token);

        log("platformVerifyLicense ÂÆüË°å");
        window.djiBridge.platformVerifyLicense(APP_ID, APP_KEY, LICENSE);
        log("platformIsVerified: " + window.djiBridge.platformIsVerified());

        const params = JSON.stringify({
          host: `tcp://${HOST}:1883`,
          connectCallback: "onConnect",
          username: USER,
          password: token
        });
        log("platformLoadComponent: " +
          window.djiBridge.platformLoadComponent("thing", params)
        );
        log("thingConnect: " +
          window.djiBridge.thingConnect(USER, token, "onConnect")
        );
        log("ÂàùÊúüÊé•Á∂öÁä∂ÊÖã: " + window.djiBridge.thingGetConnectState());
      } catch (e) {
        log(e.message);
      }
    });

    document.getElementById("logout-button").addEventListener("click", () => {
      log("platformUnloadComponent: " +
        window.djiBridge.platformUnloadComponent("thing")
      );
    });

    document.getElementById("report-button").addEventListener("click", () => {
      log("isLoaded: " + window.djiBridge.platformIsComponentLoaded("thing") +
          ", state: " + window.djiBridge.thingGetConnectState()
      );
    });

    function onConnect(code, msg) {
      log(`onConnect „Ç≥„Éº„É´„Éê„ÉÉ„ÇØ code=${code}, msg=${msg}`);
    }
    window.onConnect = onConnect;

    log("„Éö„Éº„Ç∏„É≠„Éº„ÉâÂÆå‰∫Ü");
  </script>
</body>
</html>
